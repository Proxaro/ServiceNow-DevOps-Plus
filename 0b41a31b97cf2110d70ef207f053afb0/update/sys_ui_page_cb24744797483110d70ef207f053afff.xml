<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[function devops_keydownHandler(element, event) {
	if (event.key == 'Enter' && !event.shiftKey) {	
		var message = element.value;
		element.disabled = true;
		element.value = '';
		element.setSelectionRange(0, 0);
		
		var messagesElement = document.getElementById('devops_gpt_messages');
		var messages = messagesElement.value;
		if (messages) {
			messages = JSON.parse(messages);
		} else {
			messages = [{
				role: 'system',
				content: 'You are working as a co-pilot for a ServiceNow developer most likely asking you to write ServiceNow JavaScript code. If a script shall be produced, please do not privide explanations, just output the script (with markdown wrapper).'
			}];
		}
		
		messages.push({
			role: 'user',
			content: message
		});
		messagesElement.value = JSON.stringify(messages);
		
		var chatHistoriesElement = document.getElementById('devops_conversation');
		var userInputElement = document.createElement('li');
		userInputElement.style.backgroundColor = 'lightgrey';
		userInputElement.appendChild(document.createTextNode(message));
		chatHistoriesElement.insertBefore(userInputElement, element.parentNode);
		
		var ga = new GlideAjax('x_424426_devops.GPTUtil').setScope('x_424426_devops');
		ga.addParam('sysparm_name', 'prompt');
		ga.addParam('messages', messagesElement.value);
		ga.getXMLAnswer(function (result) {
			result = JSON.parse(result);
			if (result.status == 'success') {				
				var chatHistoryElement = document.createElement('li');
				var historyContent = document.createElement('md-block');
				historyContent.innerHTML = result.response;
				chatHistoryElement.appendChild(historyContent);

				chatHistoriesElement.insertBefore(chatHistoryElement, element.parentNode);
				element.disabled = false;
				element.focus();
			} else if (result.message) {
				jslog(result.message, 'devops_gpt_conversation');
			}
		});
	}
}]]></client_script>
        <description/>
        <direct>false</direct>
        <endpoint>x_424426_devops_gpt_conversation.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
	<script type="module" src="https://md-block.verou.me/md-block.js"></script>
	<input type="hidden" id="devops_gpt_messages" />
	<ul id="devops_conversation" style="list-style-type: none; padding: 0; margin: 0;">
		<li>
			<textarea style="width: 100%" onkeydown="devops_keydownHandler(this, event)" placeholder="Hit &lt;Enter&gt; to send your message" />
		</li>
	</ul>
</j:jelly>]]></html>
        <name>gpt_conversation</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-07-19 19:49:50</sys_created_on>
        <sys_id>cb24744797483110d70ef207f053afff</sys_id>
        <sys_mod_count>30</sys_mod_count>
        <sys_name>gpt_conversation</sys_name>
        <sys_package display_value="DevOps+" source="x_424426_devops">0b41a31b97cf2110d70ef207f053afb0</sys_package>
        <sys_policy/>
        <sys_scope display_value="DevOps+">0b41a31b97cf2110d70ef207f053afb0</sys_scope>
        <sys_update_name>sys_ui_page_cb24744797483110d70ef207f053afff</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-07-20 13:12:48</sys_updated_on>
    </sys_ui_page>
</record_update>
